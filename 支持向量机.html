<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ æ”¯æŒå‘é‡æœºç®—æ³•å¯è§†åŒ–</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .section-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #2c3e50;
            font-weight: 600;
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            background: white;
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-label { font-size: 0.85em; opacity: 0.9; }
        .stat-value { font-size: 1.6em; font-weight: bold; margin-top: 5px; }

        .controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 24px;
            font-size: 0.95em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-step { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .btn-reset { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 750px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .right-panel::-webkit-scrollbar {
            width: 8px;
        }

        .right-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .right-panel::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .right-panel::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .calc-panel {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .calc-panel::-webkit-scrollbar {
            width: 10px;
        }

        .calc-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .calc-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .calc-panel::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .calc-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .step-box {
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .step-init { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .step-calc { background: #fff3e0; border-left: 4px solid #ff9800; }
        .step-update { background: #f3e5f5; border-left: 4px solid #9c27b0; }
        .step-result { background: #e8f5e9; border-left: 4px solid #4caf50; }

        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.05);
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 0.9em;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
            margin: 10px 0;
        }

        .data-table th, .data-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .highlight-positive { background: rgba(46, 204, 113, 0.2); }
        .highlight-negative { background: rgba(231, 76, 60, 0.2); }

        .status {
            text-align: center;
            padding: 12px;
            background: #e8f5e9;
            border-radius: 10px;
            font-size: 1em;
            color: #2e7d32;
            font-weight: 600;
        }

        .status.running {
            background: #fff3e0;
            color: #e65100;
        }

        .explanation {
            background: #fff9c4;
            border-left: 4px solid #fbc02d;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            color: #5d4037;
            line-height: 1.8;
        }

        .explanation h4 {
            color: #f57f17;
            margin-bottom: 8px;
        }

        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .new-step {
            animation: fadeInSlide 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ”¯æŒå‘é‡æœºç®—æ³•å¯è§†åŒ–</h1>
        <p class="subtitle">SVM - å¯»æ‰¾æœ€å¤§é—´éš”çš„åˆ†ç±»è¶…å¹³é¢</p>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">è¿­ä»£æ¬¡æ•°</div>
                <div class="stat-value" id="iteration">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ”¯æŒå‘é‡æ•°</div>
                <div class="stat-value" id="svCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">é—´éš”å®½åº¦</div>
                <div class="stat-value" id="margin">0.00</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="section">
                <div class="section-title">å†³ç­–è¾¹ç•Œå¯è§†åŒ–</div>
                <canvas id="svmCanvas" width="800" height="480"></canvas>
                
                <div class="controls">
                    <button class="btn-step" onclick="stepTrain()" id="stepBtn">â­ï¸ å•æ­¥æ‰§è¡Œ</button>
                    <button class="btn-reset" onclick="reset()">ğŸ”„ é‡ç½®</button>
                </div>

                <div class="status" id="status">
                    å‡†å¤‡å°±ç»ªï¼ç‚¹å‡»"å•æ­¥æ‰§è¡Œ"å¼€å§‹è®­ç»ƒ
                </div>
            </div>

            <div class="right-panel">
                <div class="calc-panel">
                    <div class="calc-title">ğŸ“Š è®­ç»ƒæ•°æ®</div>
                    <table class="data-table" id="dataTable"></table>
                </div>

                <div class="calc-panel">
                    <div class="calc-title">ğŸ“ è®¡ç®—è¿‡ç¨‹</div>
                    <div id="calcDetails" style="font-size: 0.9em; position: relative;"></div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h4>ğŸ’¡ æ”¯æŒå‘é‡æœºç®—æ³•åŸç†</h4>
            <p>
                <strong>æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰</strong>æ˜¯ä¸€ç§å¼ºå¤§çš„åˆ†ç±»ç®—æ³•ï¼Œé€šè¿‡å¯»æ‰¾æœ€å¤§é—´éš”çš„è¶…å¹³é¢æ¥åˆ†ç¦»æ•°æ®ï¼š
            </p>
            <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                <li><strong>å†³ç­–è¾¹ç•Œ</strong>: wÂ·x + b = 0 - åˆ†ç±»è¶…å¹³é¢</li>
                <li><strong>é—´éš”ï¼ˆMarginï¼‰</strong>: 2/||w|| - è¶…å¹³é¢åˆ°æœ€è¿‘ç‚¹çš„è·ç¦»</li>
                <li><strong>æ”¯æŒå‘é‡</strong>: ä½äºé—´éš”è¾¹ç•Œä¸Šçš„ç‚¹ï¼Œå†³å®šè¶…å¹³é¢ä½ç½®</li>
                <li><strong>ä¼˜åŒ–ç›®æ ‡</strong>: æœ€å¤§åŒ–é—´éš”ï¼ŒåŒæ—¶æœ€å°åŒ–åˆ†ç±»é”™è¯¯</li>
                <li><strong>æŸå¤±å‡½æ•°</strong>: Hinge Loss + L2æ­£åˆ™åŒ–</li>
            </ul>
        </div>

        <div style="margin-top: 30px; padding: 20px; text-align: center; border-top: 2px solid #e0e0e0;">
            <a href="https://github.com/happydog-intj/ai-learning-pages" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #24292e 0%, #3d4349 100%); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                <span>View on GitHub</span>
            </a>
        </div>
    </div>

    <script>
        // è®­ç»ƒæ•°æ®
        const DATA = [
            {x1: 2, x2: 3, label: 1},
            {x1: 3, x2: 3.5, label: 1},
            {x1: 3.5, x2: 4, label: 1},
            {x1: 4, x2: 5, label: 1},
            {x1: 5, x2: 5.5, label: 1},
            {x1: 5.5, x2: 6, label: 1},
            {x1: 2.5, x2: 2, label: 1},
            {x1: 4.5, x2: 4, label: 1},
            
            {x1: 1, x2: 1, label: -1},
            {x1: 1.5, x2: 1.5, label: -1},
            {x1: 2, x2: 1.2, label: -1},
            {x1: 2.5, x2: 1, label: -1},
            {x1: 3, x2: 1.5, label: -1},
            {x1: 3.5, x2: 2, label: -1},
            {x1: 1.2, x2: 2, label: -1},
            {x1: 2.8, x2: 2.2, label: -1}
        ];

        const canvas = document.getElementById('svmCanvas');
        const ctx = canvas.getContext('2d');

        // çŠ¶æ€
        let state = {
            w: [0.5, 0.5],  // æƒé‡å‘é‡
            b: -2,          // åç½®
            iteration: 0,
            learningRate: 0.01,
            C: 1.0,         // æ­£åˆ™åŒ–å‚æ•°
            supportVectors: new Set(),
            maxIterations: 50
        };

        let currentStep = 0;
        let allSteps = [];

        // æ˜¾ç¤ºæ•°æ®è¡¨
        function displayDataTable() {
            const table = document.getElementById('dataTable');
            let html = '<thead><tr>';
            html += '<th>åºå·</th><th>xâ‚</th><th>xâ‚‚</th><th>ç±»åˆ«</th></tr></thead><tbody>';

            DATA.forEach((d, i) => {
                const rowClass = d.label === 1 ? 'highlight-positive' : 'highlight-negative';
                html += `<tr class="${rowClass}">`;
                html += `<td>${i + 1}</td>`;
                html += `<td>${d.x1.toFixed(1)}</td>`;
                html += `<td>${d.x2.toFixed(1)}</td>`;
                html += `<td><strong>${d.label === 1 ? '+1' : '-1'}</strong></td>`;
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // ç»˜åˆ¶ç”»å¸ƒ
        function draw() {
            const W = 800, H = 480;
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, W, H);

            const PAD = 60;
            const SCALE = 70;
            const tx = x => PAD + x * SCALE;
            const ty = y => H - PAD - y * SCALE;

            // ç½‘æ ¼
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 8; i++) {
                ctx.beginPath();
                ctx.moveTo(tx(i), PAD);
                ctx.lineTo(tx(i), H - PAD);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(PAD, ty(i));
                ctx.lineTo(W - PAD, ty(i));
                ctx.stroke();
            }

            // åæ ‡è½´
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(PAD, H - PAD);
            ctx.lineTo(W - PAD, H - PAD);
            ctx.moveTo(PAD, PAD);
            ctx.lineTo(PAD, H - PAD);
            ctx.stroke();

            // å†³ç­–è¾¹ç•Œå’Œé—´éš”è¾¹ç•Œ
            if (state.iteration > 0) {
                const [w1, w2] = state.w;
                const b = state.b;
                
                // è®¡ç®—è¾¹ç•Œçº¿
                const y0 = (0) => (-b - w1 * 0) / w2;
                const y8 = (8) => (-b - w1 * 8) / w2;
                
                // é—´éš”è¾¹ç•Œ
                const yMarginPos0 = (-b - w1 * 0 + 1) / w2;
                const yMarginPos8 = (-b - w1 * 8 + 1) / w2;
                const yMarginNeg0 = (-b - w1 * 0 - 1) / w2;
                const yMarginNeg8 = (-b - w1 * 8 - 1) / w2;

                // ç»˜åˆ¶é—´éš”åŒºåŸŸ
                ctx.fillStyle = 'rgba(100, 150, 250, 0.1)';
                ctx.beginPath();
                ctx.moveTo(tx(0), ty(yMarginPos0));
                ctx.lineTo(tx(8), ty(yMarginPos8));
                ctx.lineTo(tx(8), ty(yMarginNeg8));
                ctx.lineTo(tx(0), ty(yMarginNeg0));
                ctx.closePath();
                ctx.fill();

                // é—´éš”è¾¹ç•Œï¼ˆè™šçº¿ï¼‰
                ctx.strokeStyle = '#9b59b6';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(tx(0), ty(yMarginPos0));
                ctx.lineTo(tx(8), ty(yMarginPos8));
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(tx(0), ty(yMarginNeg0));
                ctx.lineTo(tx(8), ty(yMarginNeg8));
                ctx.stroke();
                ctx.setLineDash([]);

                // å†³ç­–è¾¹ç•Œï¼ˆå®çº¿ï¼‰
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(tx(0), ty(y0()));
                ctx.lineTo(tx(8), ty(y8()));
                ctx.stroke();
            }

            // æ•°æ®ç‚¹
            DATA.forEach((p, i) => {
                const isSV = state.supportVectors.has(i);
                
                if (p.label === 1) {
                    ctx.fillStyle = '#2ecc71';
                    ctx.strokeStyle = '#27ae60';
                } else {
                    ctx.fillStyle = '#e74c3c';
                    ctx.strokeStyle = '#c0392b';
                }
                
                ctx.lineWidth = isSV ? 4 : 2;
                ctx.beginPath();
                ctx.arc(tx(p.x1), ty(p.x2), isSV ? 10 : 7, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                
                // æ”¯æŒå‘é‡æ ‡è®°
                if (isSV) {
                    ctx.strokeStyle = '#f39c12';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(tx(p.x1), ty(p.x2), 14, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });

            // è½´æ ‡ç­¾
            ctx.fillStyle = '#2c3e50';
            ctx.font = '13px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 8; i++) {
                ctx.fillText(i.toString(), tx(i), H - PAD + 22);
            }
            ctx.textAlign = 'right';
            for (let i = 0; i <= 8; i++) {
                ctx.fillText(i.toString(), PAD - 10, ty(i) + 5);
            }

            // è½´æ ‡é¢˜
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('xâ‚', W / 2, H - 15);
            
            ctx.save();
            ctx.translate(20, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('xâ‚‚', 0, 0);
            ctx.restore();

            // å›¾ä¾‹
            if (state.iteration > 0) {
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`w = [${state.w[0].toFixed(3)}, ${state.w[1].toFixed(3)}]`, PAD + 10, PAD + 25);
                ctx.fillText(`b = ${state.b.toFixed(3)}`, PAD + 10, PAD + 45);
            }
        }

        // è®¡ç®—å†³ç­–å‡½æ•°å€¼
        function decisionFunction(x) {
            return state.w[0] * x.x1 + state.w[1] * x.x2 + state.b;
        }

        // Hinge Lossæ¢¯åº¦
        function computeGradient() {
            let dw = [0, 0];
            let db = 0;
            let svIndices = [];
            
            DATA.forEach((p, i) => {
                const y = p.label;
                const fx = decisionFunction(p);
                
                // Hinge loss: max(0, 1 - y*f(x))
                if (y * fx < 1) {
                    dw[0] -= state.C * y * p.x1;
                    dw[1] -= state.C * y * p.x2;
                    db -= state.C * y;
                    svIndices.push(i);
                }
            });
            
            // L2æ­£åˆ™åŒ–
            dw[0] += state.w[0];
            dw[1] += state.w[1];
            
            return { dw, db, svIndices };
        }

        // å•æ­¥è®­ç»ƒ
        function stepTrain() {
            if (state.iteration >= state.maxIterations) {
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('status').textContent = 'âœ… è®­ç»ƒå®Œæˆï¼';
                return;
            }

            currentStep++;
            
            // è®¡ç®—æ¢¯åº¦
            const { dw, db, svIndices } = computeGradient();
            
            // è®°å½•æ—§å‚æ•°
            const oldW = [...state.w];
            const oldB = state.b;
            
            // æ›´æ–°å‚æ•°
            state.w[0] -= state.learningRate * dw[0];
            state.w[1] -= state.learningRate * dw[1];
            state.b -= state.learningRate * db;
            
            // æ›´æ–°æ”¯æŒå‘é‡
            state.supportVectors = new Set(svIndices);
            
            // è®¡ç®—é—´éš”
            const wNorm = Math.sqrt(state.w[0] ** 2 + state.w[1] ** 2);
            const margin = 2 / wNorm;
            
            state.iteration++;
            
            // è®°å½•æ­¥éª¤
            allSteps.push({
                iteration: state.iteration,
                oldW,
                oldB,
                newW: [...state.w],
                newB: state.b,
                dw,
                db,
                svCount: svIndices.length,
                svIndices,
                margin
            });
            
            // æ›´æ–°æ˜¾ç¤º
            updateStats();
            draw();
            showStep(allSteps.length - 1);
            
            document.getElementById('status').textContent = 
                `æ­¥éª¤ ${state.iteration}: æ›´æ–°å‚æ•° | æ”¯æŒå‘é‡: ${svIndices.length} ä¸ª`;
        }

        // æ˜¾ç¤ºè®¡ç®—æ­¥éª¤
        function showStep(index) {
            const step = allSteps[index];
            if (!step) return;
            
            const calcDetails = document.getElementById('calcDetails');
            const calcPanel = calcDetails.parentElement;
            
            if (currentStep === 1) {
                calcDetails.innerHTML = '';
            }
            
            if (currentStep > 1) {
                calcDetails.innerHTML += '<div style="border-top: 2px solid #e0e0e0; margin: 20px 0;"></div>';
            }
            
            let html = '<div class="new-step">';
            
            // æ ‡é¢˜
            html += `<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 10px; margin-bottom: 15px; font-weight: bold; font-size: 1.1em;">
                ğŸ¯ è¿­ä»£ ${step.iteration}
            </div>`;
            
            // å½“å‰å‚æ•°
            html += `<div class="step-init">
                <strong>ğŸ“Š å½“å‰å‚æ•°</strong><br>
                <div class="formula">
                    w = [${step.oldW[0].toFixed(4)}, ${step.oldW[1].toFixed(4)}]<br>
                    b = ${step.oldB.toFixed(4)}
                </div>
            </div>`;
            
            // æ”¯æŒå‘é‡æ£€æµ‹
            html += `<div class="step-calc">
                <strong>ğŸ” æ”¯æŒå‘é‡æ£€æµ‹</strong><br>
                æ£€æŸ¥æ‰€æœ‰ç‚¹æ˜¯å¦æ»¡è¶³: yÂ·(wÂ·x + b) â‰¥ 1<br>
                <div class="formula">`;
            
            if (step.svIndices.length > 0) {
                html += `æ‰¾åˆ° ${step.svIndices.length} ä¸ªæ”¯æŒå‘é‡:<br>`;
                step.svIndices.forEach(i => {
                    const p = DATA[i];
                    const fx = step.oldW[0] * p.x1 + step.oldW[1] * p.x2 + step.oldB;
                    const margin = p.label * fx;
                    html += `ã€€ç‚¹${i+1}: yÂ·f(x) = ${margin.toFixed(4)} < 1 âœ—<br>`;
                });
            } else {
                html += 'æ‰€æœ‰ç‚¹éƒ½æ»¡è¶³é—´éš”çº¦æŸ âœ“';
            }
            
            html += `</div></div>`;
            
            // æ¢¯åº¦è®¡ç®—
            html += `<div class="step-update">
                <strong>ğŸ“ æ¢¯åº¦è®¡ç®—</strong><br>
                <div class="formula">
                    âˆ‡w = w + CÂ·Î£(-yÂ·x) (æ”¯æŒå‘é‡)<br>
                    âˆ‡w = [${step.dw[0].toFixed(4)}, ${step.dw[1].toFixed(4)}]<br>
                    âˆ‡b = CÂ·Î£(-y) = ${step.db.toFixed(4)}
                </div>
            </div>`;
            
            // å‚æ•°æ›´æ–°
            html += `<div class="step-update">
                <strong>ğŸ”„ å‚æ•°æ›´æ–°</strong><br>
                <div class="formula">
                    w_new = w_old - Î·Â·âˆ‡w<br>
                    w_new = [${step.oldW[0].toFixed(4)}, ${step.oldW[1].toFixed(4)}] - ${state.learningRate}Â·[${step.dw[0].toFixed(4)}, ${step.dw[1].toFixed(4)}]<br>
                    w_new = [${step.newW[0].toFixed(4)}, ${step.newW[1].toFixed(4)}]<br><br>
                    b_new = ${step.oldB.toFixed(4)} - ${state.learningRate}Â·${step.db.toFixed(4)} = ${step.newB.toFixed(4)}
                </div>
            </div>`;
            
            // é—´éš”å®½åº¦
            html += `<div class="step-result">
                <strong>âœ… é—´éš”å®½åº¦</strong><br>
                <div class="formula">
                    ||w|| = âˆš(wâ‚Â² + wâ‚‚Â²) = ${Math.sqrt(step.newW[0]**2 + step.newW[1]**2).toFixed(4)}<br>
                    margin = 2/||w|| = <strong>${step.margin.toFixed(4)}</strong>
                </div>
            </div>`;
            
            html += '</div>';
            
            calcDetails.innerHTML += html;
            
            setTimeout(() => {
                calcPanel.scrollTo({
                    top: calcPanel.scrollHeight,
                    behavior: 'smooth'
                });
            }, 150);
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('iteration').textContent = state.iteration;
            document.getElementById('svCount').textContent = state.supportVectors.size;
            
            const wNorm = Math.sqrt(state.w[0] ** 2 + state.w[1] ** 2);
            const margin = 2 / wNorm;
            document.getElementById('margin').textContent = margin.toFixed(3);
        }

        // é‡ç½®
        function reset() {
            state = {
                w: [0.5, 0.5],
                b: -2,
                iteration: 0,
                learningRate: 0.01,
                C: 1.0,
                supportVectors: new Set(),
                maxIterations: 50
            };
            
            currentStep = 0;
            allSteps = [];
            
            document.getElementById('calcDetails').innerHTML = '<div style="color: #7f8c8d; padding: 20px; text-align: center;">ç‚¹å‡»"å•æ­¥æ‰§è¡Œ"å¼€å§‹è®­ç»ƒ...</div>';
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('status').textContent = 'å‡†å¤‡å°±ç»ªï¼ç‚¹å‡»"å•æ­¥æ‰§è¡Œ"å¼€å§‹è®­ç»ƒ';
            
            updateStats();
            draw();
        }

        // åˆå§‹åŒ–
        displayDataTable();
        updateStats();
        draw();
    </script>
</body>
</html>
