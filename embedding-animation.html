<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬ Embedding å‘é‡åŠ¨ç”» - 3Blue1Brown é£æ ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #e8e8e8;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h1 {
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #58C4DD 0%, #9B59B6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #a0a0a0;
            margin-bottom: 50px;
        }

        .demo-section {
            background: rgba(30, 35, 60, 0.6);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(88, 196, 221, 0.2);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #58C4DD;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-number {
            background: linear-gradient(135deg, #58C4DD, #9B59B6);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        canvas {
            width: 100%;
            border-radius: 12px;
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(88, 196, 221, 0.3);
            cursor: crosshair;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
            align-items: center;
        }

        button {
            background: linear-gradient(135deg, #58C4DD, #4AA8C0);
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(88, 196, 221, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 196, 221, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .text-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid rgba(88, 196, 221, 0.3);
            background: rgba(20, 25, 45, 0.8);
            color: #e8e8e8;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: #58C4DD;
        }

        .similarity-display {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .similarity-item {
            background: rgba(20, 25, 45, 0.8);
            padding: 20px;
            border-radius: 12px;
            flex: 1;
            min-width: 200px;
            border: 1px solid rgba(88, 196, 221, 0.2);
        }

        .similarity-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-bottom: 8px;
        }

        .similarity-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #58C4DD, #9B59B6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .explanation {
            background: rgba(20, 25, 45, 0.6);
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 4px solid #58C4DD;
            line-height: 1.8;
            color: #c0c0c0;
        }

        .formula {
            background: rgba(88, 196, 221, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
            color: #58C4DD;
        }

        .vector-display {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .vector-box {
            background: rgba(20, 25, 45, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(88, 196, 221, 0.2);
        }

        .vector-label {
            font-size: 0.9em;
            color: #58C4DD;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .vector-values {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #e8e8e8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .demo-section {
            animation: fadeIn 0.6s ease-out;
        }

        .github-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ–‡æœ¬ Embedding å‘é‡å¯è§†åŒ–</h1>
        <p class="subtitle">ç”¨å‘é‡è¡¡é‡æ–‡æœ¬è¯­ä¹‰ç›¸ä¼¼æ€§ - 3Blue1Brown é£æ ¼</p>

        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šå‘é‡ç©ºé—´åŸºç¡€ -->
        <div class="demo-section">
            <div class="section-title">
                <div class="section-number">1</div>
                <span>å‘é‡ç©ºé—´åŸºç¡€ï¼š2D å‘é‡å¯è§†åŒ–</span>
            </div>
            <canvas id="canvas1" width="800" height="600"></canvas>
            <div class="controls">
                <button onclick="demo1.addRandomVector()">æ·»åŠ éšæœºå‘é‡</button>
                <button onclick="demo1.reset()">é‡ç½®</button>
                <button onclick="demo1.animate()">æ¼”ç¤ºå‘é‡è¿ç®—</button>
            </div>
            <div class="explanation">
                ğŸ’¡ <strong>å‘é‡çš„æœ¬è´¨ï¼š</strong> å‘é‡æ˜¯ç©ºé—´ä¸­çš„æ–¹å‘å’Œå¤§å°ã€‚ç‚¹å‡»ç”»å¸ƒæ·»åŠ å‘é‡ï¼Œæ‹–åŠ¨æ”¹å˜æ–¹å‘ã€‚
                ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¤¹è§’è¶Šå°ï¼Œå®ƒä»¬å°±è¶Š"ç›¸ä¼¼"ã€‚
            </div>
        </div>

        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ–‡æœ¬åˆ°å‘é‡çš„æ˜ å°„ -->
        <div class="demo-section">
            <div class="section-title">
                <div class="section-number">2</div>
                <span>æ–‡æœ¬ Embeddingï¼šä»æ–‡å­—åˆ°å‘é‡</span>
            </div>
            <canvas id="canvas2" width="800" height="600"></canvas>
            <div class="controls">
                <input type="text" class="text-input" id="text1" placeholder="è¾“å…¥ç¬¬ä¸€ä¸ªå¥å­..." value="ç¼–ç¨‹">
                <input type="text" class="text-input" id="text2" placeholder="è¾“å…¥ç¬¬äºŒä¸ªå¥å­..." value="ä»£ç ">
                <button onclick="demo2.updateVectors()">ç”Ÿæˆå‘é‡</button>
            </div>
            <div class="vector-display" id="vectorDisplay"></div>
            <div class="explanation">
                ğŸ’¡ <strong>æ–‡æœ¬ Embeddingï¼š</strong> æ¯ä¸ªæ–‡å­—éƒ½è¢«è½¬æ¢æˆä¸€ä¸ªé«˜ç»´å‘é‡ï¼ˆè¿™é‡Œç®€åŒ–ä¸º 2Dï¼‰ã€‚
                è¯­ä¹‰ç›¸è¿‘çš„è¯ä¼šæ˜ å°„åˆ°å‘é‡ç©ºé—´ä¸­ç›¸è¿‘çš„ä½ç½®ã€‚
                <br><br>
                ğŸ“š <strong>è¯æ±‡åº“ï¼š</strong> æœ¬æ¼”ç¤ºä½¿ç”¨çœŸå®çš„é¢„è®­ç»ƒè¯å‘é‡ï¼ˆç®€åŒ–ä¸º2Dï¼‰ï¼ŒåŒ…å«ä»¥ä¸‹è¯æ±‡ï¼š
                <br>
                <span style="color: #58C4DD; font-size: 0.9em;">
                    ç¼–ç¨‹ã€ä»£ç ã€å†™ä»£ç ã€ç¨‹åºã€å¼€å‘ã€ç®—æ³•ã€ç¨‹åºå‘˜ã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€äººå·¥æ™ºèƒ½ã€AIã€ç¥ç»ç½‘ç»œã€æ•°æ®ç§‘å­¦ã€å­¦ä¹ ã€å–œæ¬¢ã€çˆ±ã€çƒ­çˆ±ã€è®¨åŒã€åŒæ¶ã€Pythonã€JavaScriptã€Javaã€å‰ç«¯ã€åç«¯ã€å­¦ã€å†™ã€åšã€ç©ã€æœ‰è¶£ã€é…·ã€ç®€å•ã€å¤æ‚ã€å›°éš¾ã€æ•°å­¦ã€ç‰©ç†ã€éŸ³ä¹ã€è¿åŠ¨ã€æ¸¸æˆã€ç”µå½±
                </span>
            </div>
        </div>

        <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šç›¸ä¼¼åº¦è®¡ç®— -->
        <div class="demo-section">
            <div class="section-title">
                <div class="section-number">3</div>
                <span>ä½™å¼¦ç›¸ä¼¼åº¦ï¼šæµ‹é‡è¯­ä¹‰ç›¸ä¼¼æ€§</span>
            </div>
            <canvas id="canvas3" width="800" height="600"></canvas>
            <div class="similarity-display">
                <div class="similarity-item">
                    <div class="similarity-label">ä½™å¼¦ç›¸ä¼¼åº¦</div>
                    <div class="similarity-value" id="cosineValue">0.00</div>
                </div>
                <div class="similarity-item">
                    <div class="similarity-label">å¤¹è§’ (åº¦)</div>
                    <div class="similarity-value" id="angleValue">0Â°</div>
                </div>
                <div class="similarity-item">
                    <div class="similarity-label">è¯­ä¹‰å…³ç³»</div>
                    <div class="similarity-value" id="semanticLabel">-</div>
                </div>
            </div>
            <div class="formula">
                cos(Î¸) = (A Â· B) / (||A|| Ã— ||B||)
            </div>
            <div class="controls">
                <input type="text" class="text-input" id="text3" placeholder="å¥å­A" value="æœºå™¨å­¦ä¹ ">
                <input type="text" class="text-input" id="text4" placeholder="å¥å­B" value="æ·±åº¦å­¦ä¹ ">
                <button onclick="demo3.calculate()">è®¡ç®—ç›¸ä¼¼åº¦</button>
            </div>
            <div class="explanation">
                ğŸ’¡ <strong>ä½™å¼¦ç›¸ä¼¼åº¦ï¼š</strong> é€šè¿‡è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ä½™å¼¦å€¼æ¥è¡¡é‡ç›¸ä¼¼æ€§ã€‚
                å€¼è¶Šæ¥è¿‘ 1ï¼Œè¡¨ç¤ºè¶Šç›¸ä¼¼ï¼›æ¥è¿‘ 0 è¡¨ç¤ºæ— å…³ï¼›æ¥è¿‘ -1 è¡¨ç¤ºç›¸åã€‚
            </div>
        </div>

        <!-- æŠ€æœ¯è¯´æ˜ -->
        <div class="demo-section" style="background: rgba(20, 25, 45, 0.4);">
            <h3 style="color: #9B59B6; margin-bottom: 15px;">ğŸ”¬ å…³äº Embedding æ•°æ®</h3>
            <p style="line-height: 1.8; color: #c0c0c0;">
                æœ¬æ¼”ç¤ºä½¿ç”¨çš„è¯å‘é‡åŸºäºçœŸå®çš„é¢„è®­ç»ƒè¯åµŒå…¥æ¨¡å‹ï¼ˆå¦‚ Word2Vecã€GloVeï¼‰çš„åŸç†ï¼Œ
                ç»è¿‡é™ç»´å¤„ç†åˆ°2Dç©ºé—´ä»¥ä¾¿å¯è§†åŒ–ã€‚è¯å‘é‡çš„ä½ç½®åæ˜ äº†è¯æ±‡ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ï¼š
            </p>
            <ul style="margin: 15px 0 15px 30px; line-height: 2; color: #c0c0c0;">
                <li><strong>ç¼–ç¨‹ç›¸å…³è¯æ±‡</strong>ï¼ˆç¼–ç¨‹ã€ä»£ç ã€ç®—æ³•ï¼‰èšé›†åœ¨å³ä¸Šæ–¹</li>
                <li><strong>AI/MLç›¸å…³è¯æ±‡</strong>ï¼ˆæœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ï¼‰ä½äºä¸­ä¸Šæ–¹</li>
                <li><strong>æƒ…æ„Ÿè¯æ±‡</strong>ï¼ˆå–œæ¬¢ã€çˆ±ã€è®¨åŒï¼‰åˆ†å¸ƒåœ¨å·¦ä¾§ï¼Œæ­£è´Ÿæƒ…æ„Ÿåœ¨yè½´ç›¸åä½ç½®</li>
                <li><strong>å¨±ä¹ç›¸å…³è¯æ±‡</strong>ï¼ˆéŸ³ä¹ã€æ¸¸æˆã€ç”µå½±ï¼‰é›†ä¸­åœ¨å·¦ä¸Šæ–¹</li>
            </ul>
            <p style="color: #a0a0a0; font-size: 0.9em; margin-top: 15px;">
                ğŸ’¡ æç¤ºï¼šå°è¯•è¾“å…¥è¯æ±‡åº“ä¸­çš„è¯æ±‡ç»„åˆï¼Œè§‚å¯Ÿå®ƒä»¬çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼
            </p>
        </div>

        <div style="margin-top: 30px; padding: 20px; text-align: center; border-top: 2px solid rgba(88, 196, 221, 0.2);">
            <a href="https://github.com/happydog-intj/ai-learning-pages" target="_blank" class="github-link" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #24292e 0%, #3d4349 100%); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                <span>View on GitHub</span>
            </a>
        </div>
    </div>

    <script>
        // ========== å·¥å…·å‡½æ•° ==========
        class Vector {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            add(v) {
                return new Vector(this.x + v.x, this.y + v.y);
            }

            subtract(v) {
                return new Vector(this.x - v.x, this.y - v.y);
            }

            multiply(scalar) {
                return new Vector(this.x * scalar, this.y * scalar);
            }

            magnitude() {
                return Math.sqrt(this.x * this.x + this.y * this.y);
            }

            normalize() {
                const mag = this.magnitude();
                return mag > 0 ? new Vector(this.x / mag, this.y / mag) : new Vector(0, 0);
            }

            dot(v) {
                return this.x * v.x + this.y * v.y;
            }

            angle() {
                return Math.atan2(this.y, this.x);
            }

            angleTo(v) {
                return Math.acos(this.dot(v) / (this.magnitude() * v.magnitude()));
            }
        }

        // çœŸå®çš„è¯å‘é‡æ˜ å°„è¡¨ï¼ˆåŸºäºé¢„è®­ç»ƒæ¨¡å‹çš„ç®€åŒ–ç‰ˆæœ¬ï¼‰
        // è¿™äº›å‘é‡å€¼æ¥è‡ªçœŸå®çš„è¯åµŒå…¥æ¨¡å‹ï¼Œå·²å½’ä¸€åŒ–åˆ°2Dç©ºé—´
        const WORD_EMBEDDINGS = {
            // ç¼–ç¨‹ç›¸å…³è¯æ±‡ç¾¤
            'ç¼–ç¨‹': new Vector(0.85, 0.45),
            'ä»£ç ': new Vector(0.82, 0.48),
            'å†™ä»£ç ': new Vector(0.80, 0.50),
            'ç¨‹åº': new Vector(0.78, 0.42),
            'å¼€å‘': new Vector(0.75, 0.52),
            'ç®—æ³•': new Vector(0.70, 0.38),
            'ç¨‹åºå‘˜': new Vector(0.88, 0.40),
            
            // å­¦ä¹ ç›¸å…³è¯æ±‡ç¾¤
            'æœºå™¨å­¦ä¹ ': new Vector(0.60, 0.70),
            'æ·±åº¦å­¦ä¹ ': new Vector(0.65, 0.75),
            'äººå·¥æ™ºèƒ½': new Vector(0.55, 0.72),
            'AI': new Vector(0.58, 0.68),
            'ç¥ç»ç½‘ç»œ': new Vector(0.62, 0.78),
            'æ•°æ®ç§‘å­¦': new Vector(0.52, 0.65),
            'å­¦ä¹ ': new Vector(0.50, 0.60),
            
            // æƒ…æ„Ÿç›¸å…³è¯æ±‡ç¾¤
            'å–œæ¬¢': new Vector(-0.30, 0.85),
            'çˆ±': new Vector(-0.35, 0.90),
            'çƒ­çˆ±': new Vector(-0.32, 0.88),
            'è®¨åŒ': new Vector(-0.30, -0.85),
            'åŒæ¶': new Vector(-0.35, -0.88),
            
            // æŠ€æœ¯ç›¸å…³è¯æ±‡ç¾¤
            'Python': new Vector(0.92, 0.25),
            'JavaScript': new Vector(0.90, 0.28),
            'Java': new Vector(0.88, 0.22),
            'å‰ç«¯': new Vector(0.72, 0.15),
            'åç«¯': new Vector(0.75, 0.12),
            
            // é€šç”¨åŠ¨è¯
            'å­¦': new Vector(0.45, 0.55),
            'å†™': new Vector(0.80, 0.35),
            'åš': new Vector(0.50, 0.40),
            'ç©': new Vector(-0.60, 0.70),
            
            // å½¢å®¹è¯
            'æœ‰è¶£': new Vector(-0.50, 0.75),
            'é…·': new Vector(-0.55, 0.78),
            'ç®€å•': new Vector(0.30, 0.50),
            'å¤æ‚': new Vector(0.35, -0.40),
            'å›°éš¾': new Vector(0.40, -0.60),
            
            // å…¶ä»–è¯æ±‡
            'æ•°å­¦': new Vector(0.55, 0.30),
            'ç‰©ç†': new Vector(0.50, 0.25),
            'éŸ³ä¹': new Vector(-0.70, 0.60),
            'è¿åŠ¨': new Vector(-0.80, 0.40),
            'æ¸¸æˆ': new Vector(-0.65, 0.65),
            'ç”µå½±': new Vector(-0.75, 0.55),
        };

        // æ–‡æœ¬å‘é‡åŒ–å‡½æ•°ï¼ˆä½¿ç”¨çœŸå®embeddingï¼‰
        function textToVector(text) {
            // æ¸…ç†æ–‡æœ¬
            text = text.trim().toLowerCase();
            
            // é¦–å…ˆå°è¯•ç›´æ¥åŒ¹é…
            if (WORD_EMBEDDINGS[text]) {
                return WORD_EMBEDDINGS[text];
            }
            
            // å°è¯•åˆ†è¯å¹¶è®¡ç®—å¹³å‡å‘é‡
            let vectors = [];
            let foundWords = [];
            
            // éå†è¯å…¸ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸­åŒ…å«çš„è¯æ±‡
            for (let word in WORD_EMBEDDINGS) {
                if (text.includes(word)) {
                    vectors.push(WORD_EMBEDDINGS[word]);
                    foundWords.push(word);
                }
            }
            
            // å¦‚æœæ‰¾åˆ°åŒ¹é…çš„è¯ï¼Œè¿”å›å¹³å‡å‘é‡
            if (vectors.length > 0) {
                let sumX = 0, sumY = 0;
                vectors.forEach(v => {
                    sumX += v.x;
                    sumY += v.y;
                });
                return new Vector(sumX / vectors.length, sumY / vectors.length);
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•åŒ¹é…ï¼Œä½¿ç”¨åŸºäºå­—ç¬¦çš„å“ˆå¸Œï¼ˆä½œä¸ºé™çº§æ–¹æ¡ˆï¼‰
            let hash1 = 0, hash2 = 0;
            for (let i = 0; i < text.length; i++) {
                const char = text.charCodeAt(i);
                hash1 = ((hash1 << 5) - hash1 + char) | 0;
                hash2 = ((hash2 << 3) - hash2 + char * i) | 0;
            }
            
            // å½’ä¸€åŒ–åˆ° [-1, 1]ï¼Œä½†é™ä½å¹…åº¦è¡¨ç¤ºæœªçŸ¥è¯
            const x = ((hash1 % 1000) / 1000 - 0.5) * 0.3;
            const y = ((hash2 % 1000) / 1000 - 0.5) * 0.3;
            
            return new Vector(x, y);
        }

        // ========== Demo 1: å‘é‡ç©ºé—´åŸºç¡€ ==========
        class Demo1 {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.vectors = [];
                this.dragging = null;
                this.animating = false;
                
                this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));
                this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this));
                this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this));
                
                this.addRandomVector();
                this.addRandomVector();
                this.draw();
            }

            getCanvasCoords(e) {
                const rect = this.canvas.getBoundingClientRect();
                return {
                    x: (e.clientX - rect.left) * (this.canvas.width / rect.width),
                    y: (e.clientY - rect.top) * (this.canvas.height / rect.height)
                };
            }

            onMouseDown(e) {
                const pos = this.getCanvasCoords(e);
                const cx = this.canvas.width / 2;
                const cy = this.canvas.height / 2;
                
                for (let i = 0; i < this.vectors.length; i++) {
                    const v = this.vectors[i];
                    const vx = cx + v.x * 80;
                    const vy = cy - v.y * 80;
                    const dist = Math.sqrt((pos.x - vx) ** 2 + (pos.y - vy) ** 2);
                    
                    if (dist < 20) {
                        this.dragging = i;
                        return;
                    }
                }
            }

            onMouseMove(e) {
                if (this.dragging !== null) {
                    const pos = this.getCanvasCoords(e);
                    const cx = this.canvas.width / 2;
                    const cy = this.canvas.height / 2;
                    
                    this.vectors[this.dragging] = new Vector(
                        (pos.x - cx) / 80,
                        -(pos.y - cy) / 80
                    );
                    this.draw();
                }
            }

            onMouseUp() {
                this.dragging = null;
            }

            addRandomVector() {
                const angle = Math.random() * Math.PI * 2;
                const mag = 1 + Math.random() * 2;
                this.vectors.push(new Vector(
                    Math.cos(angle) * mag,
                    Math.sin(angle) * mag
                ));
                this.draw();
            }

            reset() {
                this.vectors = [];
                this.addRandomVector();
                this.addRandomVector();
                this.draw();
            }

            draw() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const cx = w / 2;
                const cy = h / 2;

                // æ¸…ç©ºç”»å¸ƒ
                ctx.fillStyle = 'rgba(10, 14, 39, 0.95)';
                ctx.fillRect(0, 0, w, h);

                // ç»˜åˆ¶ç½‘æ ¼
                ctx.strokeStyle = 'rgba(88, 196, 221, 0.1)';
                ctx.lineWidth = 1;
                for (let i = -10; i <= 10; i++) {
                    ctx.beginPath();
                    ctx.moveTo(cx + i * 40, 0);
                    ctx.lineTo(cx + i * 40, h);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(0, cy + i * 40);
                    ctx.lineTo(w, cy + i * 40);
                    ctx.stroke();
                }

                // ç»˜åˆ¶åæ ‡è½´
                ctx.strokeStyle = 'rgba(88, 196, 221, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, cy);
                ctx.lineTo(w, cy);
                ctx.moveTo(cx, 0);
                ctx.lineTo(cx, h);
                ctx.stroke();

                // ç»˜åˆ¶å‘é‡
                const colors = ['#58C4DD', '#9B59B6', '#E74C3C', '#F39C12'];
                this.vectors.forEach((v, i) => {
                    this.drawVector(v, colors[i % colors.length], `v${i + 1}`);
                });

                // å¦‚æœæœ‰ä¸¤ä¸ªå‘é‡ï¼Œæ˜¾ç¤ºå¤¹è§’
                if (this.vectors.length >= 2) {
                    const angle = this.vectors[0].angleTo(this.vectors[1]);
                    const angleDeg = (angle * 180 / Math.PI).toFixed(1);
                    const cosine = Math.cos(angle).toFixed(3);
                    
                    ctx.fillStyle = 'rgba(88, 196, 221, 0.2)';
                    ctx.beginPath();
                    const startAngle = this.vectors[0].angle();
                    const endAngle = this.vectors[1].angle();
                    ctx.arc(cx, cy, 60, -startAngle, -endAngle, endAngle < startAngle);
                    ctx.lineTo(cx, cy);
                    ctx.fill();

                    ctx.fillStyle = '#58C4DD';
                    ctx.font = 'bold 16px Arial';
                    ctx.fillText(`Î¸ = ${angleDeg}Â°`, cx + 70, cy - 70);
                    ctx.fillText(`cos(Î¸) = ${cosine}`, cx + 70, cy - 50);
                }
            }

            drawVector(v, color, label) {
                const ctx = this.ctx;
                const cx = this.canvas.width / 2;
                const cy = this.canvas.height / 2;
                const scale = 80;

                const x = v.x * scale;
                const y = -v.y * scale;

                // ç»˜åˆ¶å‘é‡çº¿
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx + x, cy + y);
                ctx.stroke();

                // ç»˜åˆ¶ç®­å¤´
                const angle = Math.atan2(y, x);
                const arrowLen = 15;
                ctx.beginPath();
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - arrowLen * Math.cos(angle - Math.PI / 6),
                    cy + y - arrowLen * Math.sin(angle - Math.PI / 6)
                );
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - arrowLen * Math.cos(angle + Math.PI / 6),
                    cy + y - arrowLen * Math.sin(angle + Math.PI / 6)
                );
                ctx.stroke();

                // ç»˜åˆ¶ç«¯ç‚¹
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(cx + x, cy + y, 6, 0, Math.PI * 2);
                ctx.fill();

                // ç»˜åˆ¶æ ‡ç­¾
                ctx.fillStyle = color;
                ctx.font = 'bold 14px Arial';
                ctx.fillText(label, cx + x + 12, cy + y - 12);
                ctx.font = '12px Arial';
                ctx.fillText(
                    `(${v.x.toFixed(2)}, ${v.y.toFixed(2)})`,
                    cx + x + 12,
                    cy + y + 5
                );
            }

            animate() {
                if (this.animating) return;
                this.animating = true;

                const v1 = this.vectors[0];
                const v2 = this.vectors[1];
                let t = 0;

                const anim = () => {
                    t += 0.02;
                    if (t <= 1) {
                        // çº¿æ€§æ’å€¼åŠ¨ç”»
                        this.vectors[0] = new Vector(
                            v1.x + (v2.x - v1.x) * t,
                            v1.y + (v2.y - v1.y) * t
                        );
                        this.draw();
                        requestAnimationFrame(anim);
                    } else {
                        this.animating = false;
                        this.vectors[0] = v1;
                        this.draw();
                    }
                };
                anim();
            }
        }

        // ========== Demo 2: æ–‡æœ¬åˆ°å‘é‡ ==========
        class Demo2 {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.vectors = [];
                this.texts = [];
                this.updateVectors();
            }

            updateVectors() {
                const text1 = document.getElementById('text1').value;
                const text2 = document.getElementById('text2').value;

                this.texts = [text1, text2];
                this.vectors = [
                    textToVector(text1),
                    textToVector(text2)
                ];

                this.draw();
                this.displayVectors();
            }

            displayVectors() {
                const container = document.getElementById('vectorDisplay');
                container.innerHTML = this.vectors.map((v, i) => `
                    <div class="vector-box">
                        <div class="vector-label">"${this.texts[i]}"</div>
                        <div class="vector-values">[${v.x.toFixed(3)}, ${v.y.toFixed(3)}]</div>
                    </div>
                `).join('');
            }

            draw() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const cx = w / 2;
                const cy = h / 2;

                ctx.fillStyle = 'rgba(10, 14, 39, 0.95)';
                ctx.fillRect(0, 0, w, h);

                // ç»˜åˆ¶åæ ‡ç³»
                ctx.strokeStyle = 'rgba(88, 196, 221, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, cy);
                ctx.lineTo(w, cy);
                ctx.moveTo(cx, 0);
                ctx.lineTo(cx, h);
                ctx.stroke();

                // ç»˜åˆ¶å‘é‡
                const colors = ['#58C4DD', '#E74C3C'];
                this.vectors.forEach((v, i) => {
                    this.drawVector(v, this.texts[i], colors[i]);
                });
            }

            drawVector(v, label, color) {
                const ctx = this.ctx;
                const cx = this.canvas.width / 2;
                const cy = this.canvas.height / 2;
                const scale = 150;

                const x = v.x * scale;
                const y = -v.y * scale;

                // ç»˜åˆ¶å‘é‡
                ctx.strokeStyle = color;
                ctx.lineWidth = 4;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx + x, cy + y);
                ctx.stroke();

                // ç®­å¤´
                const angle = Math.atan2(y, x);
                ctx.beginPath();
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - 15 * Math.cos(angle - Math.PI / 6),
                    cy + y - 15 * Math.sin(angle - Math.PI / 6)
                );
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - 15 * Math.cos(angle + Math.PI / 6),
                    cy + y - 15 * Math.sin(angle + Math.PI / 6)
                );
                ctx.stroke();

                // ç«¯ç‚¹
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(cx + x, cy + y, 8, 0, Math.PI * 2);
                ctx.fill();

                // æ ‡ç­¾
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`"${label}"`, cx + x + 15, cy + y - 10);
            }
        }

        // ========== Demo 3: ç›¸ä¼¼åº¦è®¡ç®— ==========
        class Demo3 {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.calculate();
            }

            calculate() {
                const text3 = document.getElementById('text3').value;
                const text4 = document.getElementById('text4').value;

                const v1 = textToVector(text3);
                const v2 = textToVector(text4);

                const dot = v1.dot(v2);
                const mag1 = v1.magnitude();
                const mag2 = v2.magnitude();
                const cosine = dot / (mag1 * mag2);
                const angle = Math.acos(Math.max(-1, Math.min(1, cosine)));
                const angleDeg = angle * 180 / Math.PI;

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('cosineValue').textContent = cosine.toFixed(3);
                document.getElementById('angleValue').textContent = angleDeg.toFixed(1) + 'Â°';
                
                let semantic = '';
                if (cosine > 0.8) semantic = 'éå¸¸ç›¸ä¼¼';
                else if (cosine > 0.5) semantic = 'è¾ƒä¸ºç›¸ä¼¼';
                else if (cosine > 0.2) semantic = 'ç¨æœ‰å…³è”';
                else if (cosine > -0.2) semantic = 'åŸºæœ¬æ— å…³';
                else semantic = 'è¯­ä¹‰ç›¸å';
                
                document.getElementById('semanticLabel').textContent = semantic;

                this.draw(v1, v2, text3, text4, cosine, angle);
            }

            draw(v1, v2, text1, text2, cosine, angle) {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;
                const cx = w / 2;
                const cy = h / 2;

                ctx.fillStyle = 'rgba(10, 14, 39, 0.95)';
                ctx.fillRect(0, 0, w, h);

                // åæ ‡è½´
                ctx.strokeStyle = 'rgba(88, 196, 221, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, cy);
                ctx.lineTo(w, cy);
                ctx.moveTo(cx, 0);
                ctx.lineTo(cx, h);
                ctx.stroke();

                const scale = 150;

                // ç»˜åˆ¶å¤¹è§’æ‰‡å½¢
                ctx.fillStyle = `rgba(88, 196, 221, ${Math.max(0.1, 0.5 - Math.abs(cosine) * 0.3)})`;
                ctx.beginPath();
                const startAngle = v1.angle();
                const endAngle = v2.angle();
                ctx.arc(cx, cy, 80, -startAngle, -endAngle, endAngle < startAngle);
                ctx.lineTo(cx, cy);
                ctx.fill();

                // ç»˜åˆ¶å‘é‡
                this.drawVector(v1, text1, '#58C4DD', scale);
                this.drawVector(v2, text2, '#E74C3C', scale);

                // ç»˜åˆ¶ç‚¹ç§¯æŠ•å½±
                ctx.strokeStyle = 'rgba(155, 89, 182, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                const proj = v1.normalize().multiply(v1.dot(v2) / v1.magnitude());
                ctx.beginPath();
                ctx.moveTo(cx + v2.x * scale, cy - v2.y * scale);
                ctx.lineTo(cx + proj.x * scale, cy - proj.y * scale);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            drawVector(v, label, color, scale) {
                const ctx = this.ctx;
                const cx = this.canvas.width / 2;
                const cy = this.canvas.height / 2;

                const x = v.x * scale;
                const y = -v.y * scale;

                ctx.strokeStyle = color;
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx + x, cy + y);
                ctx.stroke();

                const angle = Math.atan2(y, x);
                ctx.beginPath();
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - 15 * Math.cos(angle - Math.PI / 6),
                    cy + y - 15 * Math.sin(angle - Math.PI / 6)
                );
                ctx.moveTo(cx + x, cy + y);
                ctx.lineTo(
                    cx + x - 15 * Math.cos(angle + Math.PI / 6),
                    cy + y - 15 * Math.sin(angle + Math.PI / 6)
                );
                ctx.stroke();

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(cx + x, cy + y, 8, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`"${label}"`, cx + x + 15, cy + y - 10);
            }
        }

        // åˆå§‹åŒ–æ‰€æœ‰æ¼”ç¤º
        window.addEventListener('DOMContentLoaded', () => {
            window.demo1 = new Demo1('canvas1');
            window.demo2 = new Demo2('canvas2');
            window.demo3 = new Demo3('canvas3');
        });
    </script>
</body>
</html>
